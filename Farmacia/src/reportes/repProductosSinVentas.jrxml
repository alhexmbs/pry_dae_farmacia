<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report name" pageWidth="595" pageHeight="842" columnWidth="535" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="f59a9d56-7fd2-49da-8d08-44962a7e5aa8">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="fechaIni" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fechaFin" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
    p.id_producto,
    p.nombre,
    ff.forma_farmaceutica,
    dpf.precio_venta,
    COALESCE(SUM(pdpf.cantidad), 0) AS cantidad_vendida,
    dpf.stock AS stock_actual
FROM
    producto_farmaceutico p
JOIN
    detalle_producto_forma dpf ON p.id_producto = dpf.id_producto
JOIN
    forma_farmaceutica ff ON dpf.id_frm_farma = ff.id_frm_farma
LEFT JOIN
    pedido_detalle_producto_forma pdpf ON dpf.id_frm_farma = pdpf.id_frm_farma
    AND dpf.id_producto = pdpf.id_producto
    AND pdpf.id_pedido IN (SELECT id_pedido FROM pedido WHERE fecha_hora BETWEEN $P{fechaIni} AND $P{fechaFin})
WHERE
    pdpf.id_producto IS NULL
GROUP BY
    p.id_producto, p.nombre, ff.forma_farmaceutica, dpf.precio_venta, dpf.stock;]]>
	</queryString>
	<field name="id_producto" class="java.lang.Integer"/>
	<field name="nombre" class="java.lang.String"/>
	<field name="forma_farmaceutica" class="java.lang.String"/>
	<field name="precio_venta" class="java.math.BigDecimal"/>
	<field name="cantidad_vendida" class="java.lang.Long"/>
	<field name="stock_actual" class="java.lang.Integer"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="79" splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="35" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="61" splitType="Stretch">
			<staticText>
				<reportElement x="36" y="14" width="100" height="20" uuid="a70810b2-5f5e-4d92-89dc-3a371630fc0c"/>
				<text><![CDATA[id_producto]]></text>
			</staticText>
			<staticText>
				<reportElement x="156" y="14" width="100" height="20" uuid="ea93c3ad-b145-4762-8bca-2a0cba91e825"/>
				<text><![CDATA[nombre]]></text>
			</staticText>
			<staticText>
				<reportElement x="274" y="14" width="100" height="20" uuid="a9234240-8299-425c-bd4a-e9a02b755f0a"/>
				<text><![CDATA[forma_farmaceutica]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="125" splitType="Stretch">
			<textField>
				<reportElement x="36" y="24" width="100" height="20" uuid="6051a607-854c-4030-9cd8-a7b2e2ec6188"/>
				<textFieldExpression><![CDATA[$F{id_producto}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="156" y="24" width="100" height="20" uuid="f181f51b-bdee-468a-8d2d-b6c4a4f5c0c5"/>
				<textFieldExpression><![CDATA[$F{nombre}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="274" y="24" width="100" height="20" uuid="587d7802-988e-4c85-8ee2-9fe2751cf9b8"/>
				<textFieldExpression><![CDATA[$F{forma_farmaceutica}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="45" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="54" splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="42" splitType="Stretch"/>
	</summary>
</jasperReport>
